"function escapeHTML(unsafe) {\n  if (unsafe === undefined) {\n      return \"\";\n  }\n  return unsafe.replace(\n    /[\\u0000-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u00FF]/g,\n    c => '&#' + ('000' + c.charCodeAt(0)).slice(-4) + ';'\n  )\n}\nplain_user = data.data.user_id;\nif (data.data.can_contact != \"true\") {\n    plain_user = plain_user.replace(\":\", \"/\");\n    html_user = escapeHTML(plain_user) + \": \";\n    html_user = '<font color=\"#808080\">' + html_user.replace(\"&#58;\", \"/\") + \"</font>\";\n} else {\n    html_user = escapeHTML(plain_user) + \": \";\n}\nplain = plain_user + \": \" + data.user_text.replace(/\\n\\n\\n\\n.*/s, ' [...]');\nhtml = html_user + data.user_text.replace(/\\n\\n\\n\\n(.*)/s, '');\nif (data.user_text.includes(\"\\n\\n\\n\\n\")) {\n    html += \"<br/>\" + data.user_text.replace(/.*\\n\\n\\n\\n(.*)/s, ' <details><summary>[...]</summary><pre><code>$1</code></pre></details>');\n}\n/*\nif (data.data.is_debug_build == \"true\") {\n    html = '<font color=\"#00ffff\">' + html + \"</font>\";\n}\n*/\nfunction appendValue(key, value = undefined, html_value = undefined) {\n    if (value === undefined) {\n        value = Reflect.get(data.data, key);\n    }\n    if (html_value === undefined) {\n        html_value = \"<code>\" + escapeHTML(value) + \"</code>\";\n    }\n    if (key === undefined) {\n        key = \"\";\n    } else {\n        key += \": \";\n    }\n    html += key + html_value + \"<br/>\\n\";\n    plain += key + value + \"\\n\";\n}\nhtml += \"<hr/>\";\nplain += \"\\n\\n\";\nlabels = data.labels.filter(label =>\n    !label.startsWith(\"mxid:\") &&\n    !label.startsWith(\"hs:\")\n).join(\", \");\nappendValue(undefined, labels);\nappendValue(\"app\", data.app);\nappendValue(\"os\");\nissue_name = data.report_url.replace(new RegExp(\".*issues/\"), '#');\nif (issue_name == data.report_url) {\n    issue_name = \"Report\";\n}\nhtml += '<a href=\"' + escapeHTML(data.report_url) + '\">' + escapeHTML(issue_name) + \"</a><br/>\";\nif (data.logs) {\n    log_count = data.logs.length;\n} else {\n    log_count = 0;\n}\nplain += log_count + \" logs\\n\";\nhtml += '<a href=\"' + escapeHTML(data.listing_url) + '\">' + log_count + \" logs</a>\";\nplain += \"\\n\\n\";\nhtml += \"\\n<p><details><summary>Raw data</summary><pre><code class=\\\"language-json\\\">\" +\n    JSON.stringify(data, null, 2) +\n    \"</code></pre></details>\";\nresult = {\n  \"version\": \"v2\",\n  \"empty\": false,\n  \"plain\": plain,\n  \"html\": html,\n  \"msgtype\": \"m.text\",\n}\n"
